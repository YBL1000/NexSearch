<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>NexWeb Search</title>
<style>
  body {
    background:#121212;color:#eee;font-family:sans-serif;margin:0;
    display:flex;flex-direction:column;height:100vh;
  }
  header {
    padding:20px;background:#1f1f1f;display:flex;gap:10px;
    align-items:center;box-shadow:0 2px 8px rgba(0,0,0,0.5);
  }
  input {
    flex:1;padding:10px;border:none;border-radius:8px;
    font-size:1rem;background:#333;color:#eee;
  }
  button {
    background:#3a86ff;border:none;color:#fff;padding:10px 16px;
    border-radius:8px;font-size:1rem;cursor:pointer;
  }
  button:hover {background:#5a9dff;}
  #results {
    flex:1;overflow:auto;padding:20px;display:grid;
    grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
    gap:16px;
  }
  .card {
    background:#1e1e1e;border-radius:12px;padding:12px;
    display:flex;flex-direction:column;gap:6px;
    box-shadow:0 0 10px rgba(0,0,0,0.4);
  }
  .card h3 {margin:0;font-size:1.1rem;color:#3a86ff;}
  .card p {margin:0;font-size:0.9rem;color:#ccc;}
  .card a {
    color:#fff;text-decoration:none;font-size:0.9rem;
    background:#333;padding:6px 10px;border-radius:6px;
    align-self:flex-start;margin-top:6px;cursor:pointer;
    display:inline-block;
  }
  .card a:hover {background:#555;}
</style>
</head>
<body>
<header>
  <input id="query" placeholder="Search for HTML files…">
  <button id="searchBtn">Search</button>
</header>
<div id="results"></div>

<script>
async function searchGitHub() {
  const q = document.getElementById('query').value.trim();
  if (!q) return;
  document.getElementById('results').innerHTML = '<p>Searching…</p>';

  try {
    // Search for html code files containing q
    const resp = await fetch(`https://api.github.com/search/code?q=${encodeURIComponent(q)}+extension:html&per_page=50`);
    const data = await resp.json();

    if (!data.items || data.items.length === 0) {
      document.getElementById('results').innerHTML = '<p>No HTML files found.</p>';
      return;
    }

    const allowedNames = ['index.html', 'main.html', 'home.html'];
    const cards = [];

    for (const item of data.items) {
      const fileName = item.name.toLowerCase();
      if (!allowedNames.includes(fileName)) continue; // only allow index/main/home

      const repoName = item.repository.full_name;
      const repoDesc = item.repository.description || 'No description';
      const filePath = item.path;
      const owner = item.repository.owner.login;
      const nexUrl = `Nex://${owner}.web/${item.repository.name}/${filePath}`;

      cards.push(`
        <div class="card">
          <h3>${repoName}</h3>
          <p>${repoDesc}</p>
          <p><strong>File:</strong> ${filePath}</p>
          <a onclick="openInNex('${nexUrl}')">Open in NexWeb</a>
        </div>
      `);
    }

    if (cards.length === 0) {
      document.getElementById('results').innerHTML = '<p>No matching index/main/home HTML files found.</p>';
    } else {
      document.getElementById('results').innerHTML = cards.join('');
    }
  } catch (err) {
    console.error(err);
    document.getElementById('results').innerHTML = '<p>Error searching GitHub.</p>';
  }
}

// open result in a new NexWeb tab
function openInNex(url) {
  if (parent && typeof parent.addTab === 'function') {
    parent.addTab(url);
  } else {
    alert('Could not communicate with NexWeb parent frame.');
  }
}

document.getElementById('searchBtn').onclick = searchGitHub;
document.getElementById('query').addEventListener('keydown', e=>{
  if (e.key === 'Enter') searchGitHub();
});
</script>
</body>
</html>
